# Particle Swarm Exchange Algorithm for Model-Discrimination Designs

This is the user guide of the Particle Swarm Exchange Algorithm

[**CLICK HERE**](https://pingyangchen.github.io/swarmexchange/)

There is a R function, `rDiscreteDesignPSO`, coded based on the PSE algorithm. Before implementing `rDiscreteDesignPSO`, we need to specify the design problem through  `rGetDesignInfo`, and set up the proper tuning parameters for PSE via  `rGetAlgInfo`. We would introduce these three R functions in the following.

- Chen, P.-Y., Chen, R.-B., Li, J.-P. and Li, W. W. (2021+). Particle Swarm Exchange Algorithms with Applications in Generating Optimal Model-Discrimination Designs. *Preprint*.

## Design Requirements Setting

`rGetDesignInfo`

| `rGetDesignInfo` <br> Input Option | Description | Default Value |
| ----------------------------- | ----------- | ------------- |
| `typeCrit` | **Model-discrimination Designs** <br> `1`: ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\overline{AF}) criterion <br> `2`: ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\overline{EPD}) criterion <br> `3`: Negative ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\overline{A^S}) criterion <br> `4`:  ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\overline{ENCP}) criterion <br> **Model-robust Designs** <br> `0`: Estimation capacity criterion <br> `5`:  Information capacity criterion | -- |
| `n`        | (Positive integer) Run size                     | -- |
| `m`        | (Positive integer) Number of factors            | -- |
| `mSpName`  | `'MEPI'`: MEPI space <br> `'PMS'`: PMS space    | -- |
| `g`        | (Positive integer) MEPI parameter               | -- |
| `q`        | (Positive integer) PMS parameter                | -- |
| `labLevel` | (vector) the labels of factor levels            | `c(-1, 1)` |
| `balance`  | `0`: unbalance design <br> `1`: balanced design | -- |



## Particle Swarm Exchange Algorithm

`rGetAlgInfo`: the configuration of the PSE algorithm
```{r}
algInfo <- rGetAlgInfo(nSwarm, maxIter, MIX_C = 1, MIX_R = 1, JFO_RV = 1.0, JFO_R0 = 0.9, JFO_R1 = 0.3, JFO_RHO = 0.5)
```

| `rGetAlgInfo` <br> Input Option | Description | Default Value |
| ------------------------------- | ----------- | ------------- |
| `nSwarm`  | (Positive integer) the number of particles   | -- |
| `maxIter` | (Positive integer) the number of iterations  | -- |
| `MIX_C`   | (Positive integer) the number of columns to be exchanged in the COLMIX operator | 1 |
| `MIX_R`   | (Positive integer) the number of rows to be exchanged in the ROWMIX operator    | 1 |
| `JFO_R0`  | ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\omega_{max}) | 0.9 |
| `JFO_R1`  | ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\omega_{min}) | 0.3 |
| `JFO_RHO` | ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\rho)        | 0.5 |
| `JFO_RV`  | the proportion of PSE updating iterations by updating  ![formula](https://render.githubusercontent.com/render/math?math=\color{white}\omega^{(t)}) | 1.0 |

![formula](https://render.githubusercontent.com/render/math?math=\color{white}\omega^{(t)}=\omega_{max}-\frac{t-1}{t_{max}-1}(\omega_{max}-\omega_{min}))


![formula](https://render.githubusercontent.com/render/math?math=\color{white}\omega^{(t)}_L=\rho(1-\omega^{(t)}),\omega^{(t)}_G=(1-\rho)(1-\omega^{(t)}))






```{r}
rDiscreteDesignPSO <- function(algInfo, designInfo, if_parallel = TRUE, seed = NULL, verbose = TRUE)
```

| `rDiscreteDesignPSO` <br> Input Option | Description | Default Value |
| ------------------------------- | ----------- | ------------- |
| `algInfo`     | R object generated by `rGetAlgInfo`  | -- |
| `designInfo`  | R object generated by `rGetDesignInfo`  | -- |
| `if_parallel` | (Boolean) to decide for using parallel computing | `TRUE` |
| `seed`        | (Positive integer) the random seed | `NULL` |
| `verbose`     | (Boolean) to decide for showing the updating message | `TRUE` |



## Exchange Type Algorithms

### Columnwise-pairwise Exchange Algorithm

`rGetColPairInfo`

```{r}
rGetColPairInfo(maxIter = 50, nTry = 1, maximize = 1, CPk = 1, tol = 0)
```

| `rGetColPairInfo` <br> Input Option | Description | Default Value |
| ------------------------------- | ----------- | ------------- |
| `maxIter`  | (Positive integer) maximal number of iterations   | 50 |
| `nTry`     | (Positive integer) the number of replications  | 1 |
| `maximize` | `0`: minization <br> `1`: maximization | 1 |
| `CPk`      | (Positive integer) | 1 |
| `tol`      | (Positive real value) stopping criterion. Set `tol = 0` for disabling | 0 |



```{r}
rDiscreteDesignColPair(algInfo, designInfo, if_parallel = TRUE, seed = NULL, verbose = TRUE)
```

| `rDiscreteDesignColPair` <br> Input Option | Description | Default Value |
| ------------------------------- | ----------- | ------------- |
| `algInfo`     | R object generated by `rGetColPairInfo`  | -- |
| `designInfo`  | R object generated by `rGetDesignInfo`  | -- |
| `if_parallel` | (Boolean) to decide for using parallel computing | `TRUE` |
| `seed`        | (Positive integer) the random seed | `NULL` |
| `verbose`     | (Boolean) to decide for showing the updating message | `TRUE` |


### Coordinate Exchange Algorithm


```{r}
rGetCoorExInfo(maxIter = 50, nTry = 1, maximize = 1, tol = 0)
```

| `rGetCoorExInfo` <br> Input Option | Description | Default Value |
| ------------------------------- | ----------- | ------------- |
| `maxIter`  | (Positive integer) maximal number of iterations   | 50 |
| `nTry`     | (Positive integer) the number of replications  | 1 |
| `maximize` | `0`: minization <br> `1`: maximization | 1 |
| `tol`      | (Positive real value) stopping criterion. Set `tol = 0` for disabling | 0 |



```{r}
rDiscreteDesignCoorEx(algInfo, designInfo, if_parallel = TRUE, seed = NULL, verbose = TRUE)
```

| `rDiscreteDesignCoorEx` <br> Input Option | Description | Default Value |
| ------------------------------- | ----------- | ------------- |
| `algInfo`     | R object generated by `rGetCoorExInfo`  | -- |
| `designInfo`  | R object generated by `rGetDesignInfo`  | -- |
| `if_parallel` | (Boolean) to decide for using parallel computing | `TRUE` |
| `seed`        | (Positive integer) the random seed | `NULL` |
| `verbose`     | (Boolean) to decide for showing the updating message | `TRUE` |




## Illustrative Example

**run.R**



The R script **run.R** is an example to use the PSE codes. The first step is to determine the model-discrimination design problem through  `rGetDesignInfo` function.






In PSE algorithm, user first needs to decide the number of particles, \texttt{nSwarm}, and the number of iterations, \texttt{maxIter}. Larger values of them may result the better designs, but the computational cost is higher.
\texttt{MIX\_C} is the number of columns to be exchanged in the COLMIX operator, and its default value is . Please see Section \ref{sec:pseconf} for details.  \texttt{MIX\_R} is the number of rows to be exchanged in the ROWMIX operator and its default value is fixed as 1. The parameters, \texttt{JFO\_R1}, \texttt{JFO\_R0} and \texttt{JFO\_RHO}, are the probability values, $\omega_{max}$, $\omega_{min}$ and $\rho$ for the MIX operator shown in \eqref{eq:inertia1} and \eqref{eq:inertia2}. Their default values are set as follows, $\omega_{max} = 0.9$, $\omega_{min} = 0.3$ and $\rho = 0.5$. \texttt{JFO\_RV} is between 0 and 1 and is used to denote the proportion of PSE updating iterations by updating  $\omega^{(t)}$ via \eqref{eq:inertia1} and \eqref{eq:inertia2}. For example, \texttt{JFO\_RV = 0.8} indicates that $\omega^{(t)}$ is updated by \eqref{eq:inertia1} and \eqref{eq:inertia2} in the first 80\% of the PSE iterations, and then, $\omega^{(t)}$ is fixed as $\omega_{min}$ for the remaining 20\% iterations.
Suppose we want to implement the PSE algorithm with 1000 iterations and 100 particles. In addition, the number of the columns for COLMIX operator is set as 4 and we decide not to involve ROWMIX operator. The others are fixed as the defaulty values. Therefore, we should have the PSE information as follows.\\ 
%\noindent
\texttt{algInfo <- rGetAlgInfo(100, 1000, 4, 0)}\\



In the GitHub repository, we also
developed the codes for CE and CP algorithms in functions `rDiscreteDesignCoorEx` and `rDiscreteDesignColPair` respectively. To avoid local convergence, it is recommended using multiple initial designs to run CE and CP algorithms. The users can specify the number of initial designs via the option \texttt{nTry} into the algorithms' configuration functions, `rGetCoorExInfo` and `rGetColPairInfo`, and then, the CE and CP functions can run in parallel for these independent trails.  To use CE and CP algorithms, the users can find the example codes in **run.R** file. 


```{r}
ceInfo <- rGetCoorExInfo(maxIter = 50, nTry = 5) 
ceResult <- rDiscreteDesignCoorEx(ceInfo, designInfo, if_parallel = TRUE, seed = NULL, verbose = TRUE) 
ceResult$RES$DESIGN      # The best design across 'nTry' trails 
ceResult$RES$DESIGN_VAL # The corresponding design criterion value 
```

```{r}
cpInfo <- rGetColPairInfo(maxIter = 50, nTry = 5, CPk = 1)
cpResult <- rDiscreteDesignColPair(cpInfo, designInfo, if_parallel = TRUE, seed = NULL, verbose = TRUE) 
cpResult$RES$DESIGN     # The best design across 'nTry' trails 
cpResult$RES$DESIGN_VAL # The corresponding design criterion value
```